#!/bin/bash

project="/home/ek/wgmn/frigbot"
service_name="frigbot.service"

# Handle subcommands
case "$1" in
    test)
        # Run in test DM channel with console printing
        "$project/.venv/bin/python" "$project/run.py" -t
        ;;
    kill)
        # Kill the systemd service
        sudo systemctl stop "$service_name"
        systemctl status "$service_name"
        ;;
    "")
        # Default: check if service is running, start if not, show status if running
        if systemctl is-active --quiet "$service_name"; then
            echo "Service is running. Status:"
            systemctl status "$service_name" --no-pager
        else
            echo "Service is not running. Starting..."
            sudo systemctl start "$service_name"
            sleep 1
            systemctl status "$service_name" --no-pager
        fi
        ;;
    *)
        echo "Usage: $0 [test|kill]"
        echo "  test - Run in test DM channel with console output"
        echo "  kill - Stop the systemd service"
        echo "  (no args) - Start service if not running, show status if running"
        exit 1
        ;;
esac
